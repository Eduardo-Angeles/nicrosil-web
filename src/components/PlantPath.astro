---
interface Props {
  d: string;
  rangeStart: number; // 0-100, % del scroll donde empieza a crecer
  rangeEnd: number;   // 0-100, % del scroll donde termina de crecer
  strokeWidth?: number;
}

const { d, rangeStart, rangeEnd, strokeWidth = 1.5 } = Astro.props;
---

<path
  data-plant-path
  d={d}
  fill="none"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width={strokeWidth}
  style={`animation-range: ${rangeStart}% ${rangeEnd}%;`}
/>

<style is:global>
  @keyframes draw-plant-path {
    to { stroke-dashoffset: 0; }
  }

  [data-plant-path] {
    stroke: rgba(34, 197, 94, 0.18);
    animation: draw-plant-path linear both;
    animation-timeline: scroll(root block);
  }

  .dark [data-plant-path] {
    stroke: rgba(34, 197, 94, 0.12);
  }

  /* Fallback: mostrar sin animación en navegadores que no soporten scroll-driven */
  @supports not (animation-timeline: scroll()) {
    [data-plant-path] {
      stroke-dashoffset: 0 !important;
      animation: none;
    }
  }
</style>

<script>
  // Medir la longitud real de cada path y configurar dasharray/dashoffset
  // getTotalLength() opera en coordenadas SVG, independiente del tamaño CSS.
  // Astro deduplica este script aunque PlantPath se use muchas veces.
  document.querySelectorAll<SVGPathElement>("[data-plant-path]").forEach((path) => {
    const len = path.getTotalLength();
    path.style.strokeDasharray = String(len);
    path.style.strokeDashoffset = String(len);
  });
</script>
